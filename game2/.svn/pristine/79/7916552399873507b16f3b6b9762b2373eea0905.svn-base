package action

import (
	"fmt"
	"game2/model"
	"github.com/gin-gonic/gin"
	"golang_game_merchant/global/status"
)

type AdvertisementReq struct {
	Type     int    `json:"type,omitempty"`
	Location int    `json:"location"`
}

func AdvertisementList(c *gin.Context) {
	var m AdvertisementReq
	if err:=c.BindJSON(&m);err!=nil{
		RespServerErr(c)
		return
	}
	/*
	var data interface{}
	var err error
	ty := 0
	location := 0
	type_str := c.PostForm("type")
	if type_str != "" {
		//转为整形
		ty, err = strconv.Atoi(type_str)
		if err != nil {
			fmt.Println(err)
			res := gin.H{"code": 0, "data": data, "msg": "fail"}
			c.JSON(http.StatusOK, res)
			return
		}
	}
	location_str := c.PostForm("location")
	if location_str != "" {
		//转为整形
		location, err = strconv.Atoi(location_str)
		if err != nil {
			fmt.Println(err)
			res := gin.H{"code": 0, "data": data, "msg": "fail"}
			c.JSON(http.StatusOK, res)
			return
		}
	}*/
	merchantId, ok := c.Get("merchant_id")
	fmt.Println(merchantId)
	if !ok{
		RespServerErr(c)
	}
	merchId := merchantId.(int)
	where := make(map[string]interface{})
	if m.Location == 1{
		where["location"] = m.Location
	}
	if m.Type == 1{
		where["type"] = m.Type
	}
	data,err := model.GetAdvertisementList(model.Db, merchId, where)
	if err!=nil{
		//处理
		RespServerErr(c)
	}
	RespJson(c,status.OK,data)
}
